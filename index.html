<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>DK-RPG: Online Save Test</title>
    <style>
        body { background-color: #2c3e50; color: white; font-family: 'Segoe UI', sans-serif; text-align: center; padding-top: 50px; }
        button { padding: 10px 20px; font-size: 18px; cursor: pointer; background: #e67e22; border: none; color: white; border-radius: 5px; margin: 5px; }
        button:hover { background: #d35400; }
        input { padding: 10px; font-size: 16px; border-radius: 5px; border: none; }
        .box { background: rgba(0,0,0,0.3); display: inline-block; padding: 30px; border-radius: 10px; margin-top: 20px; min-width: 300px; }
        h1 { margin-bottom: 5px; }
        small { color: #bdc3c7; }
        #status { margin-top: 20px; font-weight: bold; min-height: 24px; }
        .success { color: #2ecc71; }
        .error { color: #e74c3c; }
    </style>
</head>
<body>

    <h1>üî• DK-RPG Online System</h1>
    <small>‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Database: dk-rpg</small>
    <br><br>
    
    <div id="login-screen">
        <div class="box">
            <p>‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</p>
            <input type="text" id="username" placeholder="‡∏ä‡∏∑‡πà‡∏≠ Hero ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì...">
            <br><br>
            <button onclick="login()">üöÄ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
    </div>

    <div id="game-screen" style="display:none;">
        <h2>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö, <span id="display-name" style="color:#f1c40f"></span></h2>
        
        <div class="box">
            <p style="font-size: 24px;">Level: <span id="lvl">1</span></p>
            <p style="font-size: 24px;">Gold: <span id="gold">0</span> üí∞</p>
            <hr style="border-color: rgba(255,255,255,0.2);">
            
            <button onclick="train()">‚öîÔ∏è ‡∏ù‡∏∂‡∏Å‡∏î‡∏≤‡∏ö (XP+)</button>
            <button onclick="farm()">üíé ‡∏Ç‡∏∏‡∏î‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏á (Gold+)</button>
            <br><br>
            <button onclick="saveData()" style="background-color: #27ae60; width: 100%;">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏Å‡∏° (Save Cloud)</button>
        </div>

        <p id="status"></p>
    </div>

    <script type="module">
        // ‡πÉ‡∏ä‡πâ‡∏•‡∏¥‡∏á‡∏Å‡πå CDN ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ô‡∏ö‡∏ô Browser ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // --- Config ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (dk-rpg) ---
        const firebaseConfig = {
            apiKey: "AIzaSyB4xTY6BTjufK9fi0YlgzllOSK2349l0Zk",
            authDomain: "dk-rpg.firebaseapp.com",
            projectId: "dk-rpg",
            storageBucket: "dk-rpg.firebasestorage.app",
            messagingSenderId: "954909256548",
            appId: "1:954909256548:web:4f347b5cbf5f55fbdc6871"
        };

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡∏°
        let currentUser = "";
        let gameData = { lvl: 1, gold: 0 };

        // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÄ‡∏Å‡∏° ---
        window.login = async function() {
            const nameInput = document.getElementById('username');
            const name = nameInput.value.trim();
            
            if(!name) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö!");

            currentUser = name; // ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πá‡∏ô ID ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ã‡∏ü
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'block';
            document.getElementById('display-name').innerText = currentUser;

            await loadData(); // ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏ã‡∏ü‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤
        };

        window.train = function() {
            gameData.lvl++;
            updateUI();
        };

        window.farm = function() {
            gameData.gold += 100;
            updateUI();
        };

        function updateUI() {
            document.getElementById('lvl').innerText = gameData.lvl;
            document.getElementById('gold').innerText = gameData.gold;
            setStatus("‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á... ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡∏Å‡∏î‡πÄ‡∏ã‡∏ü‡∏ô‡∏∞", "");
        }

        function setStatus(msg, type) {
            const el = document.getElementById('status');
            el.innerText = msg;
            el.className = type;
        }

        // --- ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (Save) ---
        window.saveData = async function() {
            setStatus("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Cloud...", "");
            try {
                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏õ‡∏ó‡∏µ‡πà collection 'players' -> document ‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏≤‡∏° user
                await setDoc(doc(db, "players", currentUser), gameData);
                setStatus("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏∂‡πâ‡∏ô dk-rpg ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!", "success");
            } catch (e) {
                console.error("Save Error:", e);
                setStatus("‚ùå ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: " + e.message, "error");
            }
        };

        // --- ‡∏£‡∏∞‡∏ö‡∏ö‡πÇ‡∏´‡∏•‡∏î (Load) ---
        async function loadData() {
            setStatus("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏ã‡∏ü‡πÄ‡∏Å‡πà‡∏≤...", "");
            try {
                const docRef = doc(db, "players", currentUser);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    gameData = docSnap.data();
                    updateUI();
                    setStatus("üìÇ ‡∏û‡∏ö‡πÄ‡∏ã‡∏ü‡πÄ‡∏Å‡πà‡∏≤! ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢", "success");
                } else {
                    setStatus("‚ú® ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏ã‡∏ü ‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏™‡∏¥‡∏ô‡∏∞", "");
                }
            } catch (e) {
                console.error("Load Error:", e);
                setStatus("‚ö†Ô∏è ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏ã‡∏ü‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ô‡πá‡∏ï ‡∏´‡∏£‡∏∑‡∏≠ Permission)", "error");
            }
        }
    </script>
</body>
</html>