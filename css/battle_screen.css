/* css/battle_screen.css */

/* พื้นหลังหลักเต็มจอ */
#battle-screen {
    width: 100vw;
    height: 100vh;
    background-color: #1a1a1a;
    background-image: url('../image/world_map.png');
    background-size: cover;
    background-position: center;
    position: relative;
    overflow: hidden;
    color: #fff;
    padding: 0;
    margin: 0;
    display: block;
    -webkit-user-select: none;
    user-select: none;
}

#battle-screen::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    /* ปรับค่า 0.5 เป็น 0.3 (จาง) ถึง 0.8 (มืดมาก) ตามต้องการ */
    background-color: rgba(0, 0, 0, 0.5); 
    z-index: 0; /* ให้อยู่ชั้นล่างสุด */
    pointer-events: none; /* เพื่อให้คลิกทะลุไปโดนเนื้อหาได้ */
}

/* --- 1. Top Bar --- */
.battle-top-bar {
    position: absolute; top: 0; left: 0; width: 100%; height: 60px;
    background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent);
    display: flex; justify-content: center; /* จัดกึ่งกลาง */
    align-items: center; padding: 0 20px; box-sizing: border-box; z-index: 10;
}
.turn-badge {
    position: absolute; left: 20px; /* ย้าย Turn badge ไปซ้ายสุด */
    padding: 5px 15px; border-radius: 20px; font-weight: bold;
    text-shadow: 1px 1px 2px black; box-shadow: 0 2px 5px rgba(0,0,0,0.5);
}
.turn-badge.player { background: linear-gradient(to bottom, #2ecc71, #27ae60); color: #fff; border: 1px solid #2ecc71; }
.turn-badge.enemy { background: linear-gradient(to bottom, #e74c3c, #c0392b); color: #fff; border: 1px solid #e74c3c; }

.timer-wrapper {
    display: flex; align-items: center; gap: 10px; width: 400px;
    background: rgba(0,0,0,0.5); padding: 5px 15px; border-radius: 20px;
}
.timer-bg {
    flex: 1; height: 10px; background: #333; border-radius: 5px; border: 1px solid #555; overflow: hidden;
}
#battle-timer-bar { height: 100%; background: #f1c40f; width: 100%; transition: width 1s linear; }

.bag-action-btn {
    /* ✅ ปรับขนาดให้เป็น 80x80 เท่ากับปุ่มหนี */
    width: 80px; 
    height: 80px; 
    
    background: linear-gradient(135deg, #d35400, #a04000);
    border: 2px solid #e67e22; border-radius: 12px;
    
    /* ✅ เพิ่มขนาดไอคอนขึ้นอีกนิดให้สมส่วน */
    color: #fff; font-size: 32px; 
    
    cursor: pointer;
    display: flex; justify-content: center; align-items: center;
    box-shadow: 0 4px 10px rgba(0,0,0,0.5); transition: all 0.2s;
}

.bag-action-btn:hover { transform: scale(1.1); border-color: #f1c40f; }
.bag-action-btn:active { transform: scale(0.95); }

/* --- 2. Arena (ตัวละคร) --- */
.battle-arena {
    position: absolute;
    top: 70px;
    bottom: 25%;
    width: 100%;
    display: flex;
    justify-content: center; /* จัดกึ่งกลางแล้วใช้ gap ช่วย */
    gap: 50px; /* ระยะห่างระหว่าง Player - VS - Enemy */
    align-items: center;
    z-index: 10;
}

.fighter-card { 
    text-align: center; 
    width: 250px; /* ขยายความกว้างเผื่อแสงฟุ้ง */
    cursor: pointer; 
    transition: transform 0.2s; 
    position: relative; 
    z-index: 500;
}

/* ✅ ปรับปรุง: พื้นหลังตัวละคร (Highlight Glow) */
.fighter-avatar {
    width: 240px; 
    height: 240px;
    margin: 0 auto 5px auto;
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 50%; /* วงกลม */
    position: relative;
    
    /* พื้นหลังแบบไล่ระดับจางๆ เพื่อดันตัวละครให้เด่น */
    background: radial-gradient(circle, rgba(0,0,0,0.6) 20%, rgba(0,0,0,0) 70%);
}

/* แสงสีทองสำหรับฝั่งผู้เล่น */
.fighter-card.player .fighter-avatar {
    background: radial-gradient(circle, rgba(255, 215, 0, 0.25) 0%, rgba(0,0,0,0) 70%);
    box-shadow: 0 0 30px rgba(255, 215, 0, 0.1);
    border: 1px solid rgba(255, 215, 0, 0.1);
}

/* แสงสีแดงสำหรับฝั่งศัตรู */
.fighter-card.enemy .fighter-avatar {
    background: radial-gradient(circle, rgba(231, 76, 60, 0.25) 0%, rgba(0,0,0,0) 70%);
    box-shadow: 0 0 30px rgba(231, 76, 60, 0.1);
    border: 1px solid rgba(231, 76, 60, 0.1);
}

.fighter-avatar img { 
    width: 200px; 
    height: 200px; 
    object-fit: contain; 
    filter: drop-shadow(0 10px 10px rgba(0,0,0,0.8)); /* เงาตัวละคร */
    z-index: 2;
    transition: transform 0.2s;
}

.fighter-info { 
    background: rgba(0,0,0,0.8); /* พื้นหลังเข้มขึ้น */
    padding: 8px; 
    border-radius: 8px; 
    margin-top: -20px; /* ดึงขึ้นไปทับวงกลมหน่อยๆ */
    border: 1px solid #5d4037; 
    position: relative;
    z-index: 10;
    box-shadow: 0 4px 8px rgba(0,0,0,0.5);
}

#battle-player-img {
    transition: all 0.3s ease; /* เอฟเฟกต์นุ่มนวล */
    cursor: zoom-in;
    /* เริ่มต้น: ให้มีความสว่างปกติ */
}

#battle-player-img:hover {
    /* เมื่อชี้เมาส์: เพิ่มแสงสีขาวเรืองรองรอบตัว */
    filter: brightness(1.2) drop-shadow(0 0 5px white);
    transform: scale(1.05); /* ขยายตัวนิดหน่อย */
}

#battle-monster-img {
    cursor: zoom-in;
    transition: all 0.3s ease; /* เอฟเฟกต์นุ่มนวล */
}
#battle-monster-img:hover {
    filter: brightness(1.2) drop-shadow(0 0 5px white);
    transform: scale(1.05); /* ขยายตัวนิดหน่อย */
}

/* หลอดเลือด/มานา */
.stat-bar-group { display: flex; flex-direction: column; gap: 4px; margin-top: 5px; }
.mini-bar { 
    width: 100%; height: 18px; 
    background: #111; 
    border-radius: 9px; 
    position: relative; overflow: hidden; 
    border: 1px solid #444;
}
.mini-bar .fill { height: 100%; border-radius: 9px; transition: width 0.3s; }
.mini-bar span { 
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    font-size: 11px; font-weight: bold; color: #fff; 
    text-shadow: 1px 1px 2px black; z-index: 2; white-space: nowrap;
}
.mini-bar.hp .fill { background: linear-gradient(to right, #e74c3c, #c0392b); }
.mini-bar.mp .fill { background: linear-gradient(to right, #3498db, #2980b9); }

/* ✅ ปรับปรุง: ป้าย VS (ให้มีพื้นหลัง) */
.vs-badge { 
    font-size: 40px; font-weight: bold; color: #f1c40f; 
    text-shadow: 2px 2px 0 #000; font-style: Bold;
    background: rgba(0, 0, 0, 0.7);
    /* ✅ เพิ่ม flex-shrink: 0 เพื่อล็อกขนาดวงกลมไม่ให้โดนบีบจนเบี้ยว */
    width: 70px; height: 70px; flex-shrink: 0;
    
    border-radius: 50%; display: flex; justify-content: center; align-items: center;
    border: 3px double #e74c3c; box-shadow: 0 0 20px rgba(231, 76, 60, 0.4);
    z-index: 1005;
}

/* --- 3. Battle Log (ซ้ายล่าง สูง 20%) --- */
.battle-log-area {
    position: absolute; bottom: 0; left: 0;
    width: 300px; height: 20vh;
    background: linear-gradient(to right, rgba(0,0,0,0.9), rgba(0,0,0,0.5), transparent);
    padding: 10px; box-sizing: border-box;
    display: flex; flex-direction: column;
    pointer-events: none; border-top: 1px solid #444;
}
.battle-log-area h3 { margin: 0 0 5px 0; font-size: 14px; color: #d4af37; text-transform: uppercase; text-shadow: 1px 1px 2px black;}
.log-content {
    flex: 1; overflow: hidden; display: flex; flex-direction: column-reverse;
    font-size: 13px; text-shadow: 1px 1px 1px black;
}
.log-entry { margin-bottom: 4px; color: #ddd; }

/* --- 4. Controls (ชิดซ้าย ตามที่ขอ) --- */
.battle-controls {
    position: absolute; bottom: 0; right: 0; left: 300px;
    height: 25vh;
    background: linear-gradient(to top, rgba(0,0,0,0.95), transparent);
    display: flex; flex-direction: column; justify-content: flex-end;
    align-items: flex-start; /* ชิดซ้าย */
    padding: 20px 20px 20px 40px; 
    box-sizing: border-box;
}

.buff-row {
    height: 50px;
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
    align-items: flex-end;
    
    /* ✅ 1. ปรับตำแหน่ง: ขยับขวาเพิ่มเป็น 125px ให้ตรงกับช่องสกิลแรกเป๊ะๆ */
    margin-left: 135px; 
    /* ✅ 2. แสดงทับตัวอื่น: ให้ลอยอยู่เหนือ elements อื่นๆ ในแถบควบคุม */
    position: relative;
    z-index: 500; 
}

.buff-item {
    position: relative;
    width: 32px;
    height: 32px;
    background: linear-gradient(135deg, rgba(44, 62, 80, 0.9), rgba(0, 0, 0, 0.9));
    border: 1px solid #f1c40f;
    border-radius: 8px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 22px;
    cursor: help;
    transition: all 0.2s; /* อนิเมชั่นนุ่มนวล */
    box-shadow: 0 2px 5px rgba(0,0,0,0.5);
}

.buff-item:hover {
    /* transform: translateY(-5px) scale(1.1); <--- ของเดิมที่ทำให้กระพริบ */
    transform: scale(1.1); /* เหลือแค่ขยายขนาด */
    
    box-shadow: 0 5px 15px rgba(241, 196, 15, 0.3);
    border-color: #fff;
    z-index: 100; /* ให้ไอคอนที่ชี้อยู่บนสุดเสมอ */
}
/* --- ตัวนับเวลาถอยหลัง (ใต้ไอคอน) --- */
.buff-timer {
    position: absolute;
    bottom: -18px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 11px;
    font-weight: bold;
    color: #fff;
    text-shadow: 1px 1px 2px #000;
    white-space: nowrap;
    background: rgba(0,0,0,0.5);
    padding: 0 4px;
    border-radius: 4px;
    pointer-events: none; /* ไม่ให้บังการคลิก/hover */
}
/* --- Tooltip รายละเอียดสวยงาม (Hover) --- */
.buff-tooltip {
    visibility: hidden;
    opacity: 0;
    width: 160px;
    background-color: rgba(20, 20, 20, 0.95);
    border: 1px solid #d4af37;
    color: #fff;
    text-align: center;
    border-radius: 6px;
    padding: 10px;
    position: absolute;
    z-index: 1020; /* อยู่บนสุดจริงๆ */
    
    /* ตำแหน่งเริ่มต้น */
    bottom: 140%; 
    left: 50%;
    transform: translateX(-50%);
    
    transition: opacity 0.3s, bottom 0.3s;
    box-shadow: 0 4px 15px rgba(0,0,0,0.8);
    pointer-events: none; /* สำคัญ! ป้องกัน Tooltip แย่ง Hover ทำให้กระพริบ */
}

.buff-tooltip::after {
    content: "";
    position: absolute;
    top: 100%;
    left: 50%;
    margin-left: -6px;
    border-width: 6px;
    border-style: solid;
    border-color: rgba(20, 20, 20, 0.95) transparent transparent transparent;
}

.buff-item:hover .buff-tooltip {
    visibility: visible;
    opacity: 1;
    bottom: 125%; /* เลื่อนลงมานิดหน่อยตอนแสดง */
}

/* แถบบัพของมอนสเตอร์ (ตำแหน่งใหม่) */
.monster-buff-item {
    width: 24px; height: 24px;
    background: rgba(0,0,0,0.6);
    border: 1px solid #e74c3c;
    border-radius: 4px;
    display: flex; justify-content: center; align-items: center;
    font-size: 14px;
    cursor: help;
    flex-shrink: 0;
    
    /* ✅ เพิ่ม: เพื่อให้ Tooltip อ้างอิงตำแหน่งจากกล่องนี้ */
    position: relative;
    overflow: visible; 
    transition: transform 0.2s;
}

.buff-img-display{
    border-radius: 4px;
}

.monster-buff-item:hover {
    transform: scale(1.2);
    z-index: 100;
    border-color: #fff;
    box-shadow: 0 0 5px #e74c3c;
}

/* ✅ เพิ่ม: Tooltip สำหรับมอนสเตอร์ (ใช้สไตล์เดียวกับผู้เล่นแต่ปรับตำแหน่ง) */
.monster-buff-item .buff-tooltip {
    visibility: hidden;
    opacity: 0;
    width: 140px;
    background-color: rgba(20, 20, 20, 0.95);
    border: 1px solid #e74c3c; /* ขอบแดงตามธีมมอนสเตอร์ */
    color: #fff;
    text-align: center;
    border-radius: 6px;
    padding: 8px;
    
    position: absolute;
    bottom: 130%; /* แสดงด้านบน */
    left: 50%;
    transform: translateX(-50%);
    z-index: 101;
    
    transition: opacity 0.2s, bottom 0.2s;
    pointer-events: none;
    font-size: 11px;
    line-height: 1.4;
    box-shadow: 0 4px 10px rgba(0,0,0,0.8);
}

.monster-buff-item .buff-tooltip::after {
    content: "";
    position: absolute;
    top: 100%;
    left: 50%;
    margin-left: -5px;
    border-width: 5px;
    border-style: solid;
    border-color: rgba(20, 20, 20, 0.95) transparent transparent transparent;
}

.monster-buff-item:hover .buff-tooltip {
    visibility: visible;
    opacity: 1;
    bottom: 115%; /* Animation เลื่อนลง */
}

/* ปรับรูปให้เต็มกล่องบัพ */
.buff-img-display {
    width: 100%;
    height: 100%;
    object-fit: cover; /* ขยายรูปให้เต็มพื้นที่โดยไม่เสียสัดส่วน */
    display: block;
}

/* ปรับมุมโค้งให้เข้ากับกรอบ (ผู้เล่น) */
.buff-item .buff-img-display {
    border-radius: 6px; 
}

/* ปรับมุมโค้งให้เข้ากับกรอบ (มอนสเตอร์) */
.monster-buff-item .buff-img-display {
    border-radius: 4px; 
}

.tooltip-header {
    color: #f1c40f;
    font-weight: bold;
    font-size: 13px;
    border-bottom: 1px solid rgba(255,255,255,0.2);
    padding-bottom: 4px;
    margin-bottom: 4px;
    display: block;
}

.tooltip-desc {
    font-size: 12px;
    color: #ddd;
    line-height: 1.4;
}

.action-panel { display: flex; gap: 15px; align-items: center; }

/* Action Buttons */
.action-btn {
    border: none; border-radius: 12px;
    color: white; font-weight: bold; cursor: pointer;
    transition: all 0.2s; box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    text-shadow: 1px 1px 2px black;
}
.action-btn:active { transform: scale(0.95); }
.action-btn:hover { filter: brightness(1.2); }

/* ปุ่มโจมตี */
.attack-btn {
    width: 100px; height: 80px;
    background: linear-gradient(135deg, #c0392b, #8e44ad);
    border: 2px solid #e74c3c; font-size: 18px;
}
/* ปุ่มหนี (เท่าปุ่มโจมตี) */
.run-btn {
    width: 80px; height: 80px; 
    background: linear-gradient(135deg, #7f8c8d, #95a5a6);
    border: 2px solid #bdc3c7; font-size: 16px; color: #ecf0f1;
}

/* Skills Grid */
.skills-grid {
    display: flex; gap: 8px;
    background: rgba(0,0,0,0.6); padding: 8px; border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.2);
}
.battle-skill-slot {
    width: 55px; height: 55px;
    background: #2c3e50; border: 2px solid #34495e; border-radius: 8px;
    display: flex; justify-content: center; align-items: center;
    font-size: 24px; position: relative; transition: all 0.2s;
}
.battle-skill-slot:hover { border-color: #f1c40f; transform: translateY(-3px); }
.battle-skill-slot.cooldown { opacity: 0.5; filter: none; cursor: default; }
.battle-skill-slot.empty { background: rgba(255, 255, 255, 0.05); border: 2px dashed #555; cursor: default; }
.battle-skill-slot:not(.empty):hover { 
    border-color: #f1c40f; transform: translateY(-3px); 
    box-shadow: 0 5px 10px rgba(0,0,0,0.5); cursor: pointer;
}

/* ✅ เพิ่ม: สไตล์เมื่อมานาไม่พอ (ขาว-ดำ) */
.battle-skill-slot.no-mp {
    filter: grayscale(100%); /* เปลี่ยนเป็นขาว-ดำ */
    opacity: 0.6;            /* ทำให้จางลงเล็กน้อย */
    cursor: not-allowed;
    border-color: #555;      /* เปลี่ยนขอบเป็นสีเทา */
}

/* ✅ เพิ่ม: เลเยอร์นับถอยหลัง (Overlay) */
.cooldown-overlay {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-color: rgba(0, 0, 0, 0.7); /* พื้นหลังสีดำโปร่งแสง */
    color: #f1c40f;                       /* ตัวเลขสีทอง */
    font-size: 20px;
    font-weight: bold;
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 6px;
    z-index: 10;
    text-shadow: 1px 1px 2px #000;
}

.skill-cost {
    position: absolute; bottom: -8px; right: -5px;
    font-size: 10px; background: #2980b9; color: #fff;
    padding: 2px 5px; border-radius: 10px; border: 1px solid #fff;
    z-index: 20;
}

/* ปรับขนาดรูปสกิลให้พอดีกับปุ่ม */
.skill-img-display {
    width: 100%;
    height: 100%;
    object-fit: cover; /* ขยายรูปให้เต็มพื้นที่ปุ่ม */
    border-radius: 6px; /* มุมโค้งมน (ปรับตามดีไซน์ปุ่มของคุณ) */
    filter: drop-shadow(0 2px 2px rgba(0,0,0,0.5)); /* เงาเล็กน้อย */
}

/* ปรับให้ Overlay นับถอยหลัง (Cooldown) ทับอยู่เหนือรูปภาพ */
.skill-btn .cooldown-overlay {
    z-index: 5;
    border-radius: 6px; /* ต้องปรับมุมโค้งให้เท่ากับรูปภาพ */
}

/* (ถ้ามี) ปรับปุ่มสกิลให้ตัดส่วนเกิน */
.skill-btn {
    padding: 0; /* เอาระยะห่างออกเพื่อให้รูปเต็มปุ่ม */
    border: 1px solid #5d4037; /* เพิ่มขอบสีน้ำตาลเข้ม */
    overflow: hidden; /* ตัดส่วนที่ล้นออก */
}